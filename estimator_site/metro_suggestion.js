document.addEventListener('DOMContentLoaded', function() {
    const metroStationInput = document.getElementById('metroStation');
    const metroSuggestions = document.getElementById('metroSuggestions');
    let highlightedIndex = -1;

    // Mock array of metro station names
    const MetroStationsObject = {
        'Новокосино': (55.745113, 37.864052),
 'Новогиреево': (55.744444, 37.818333),
 'Перово': (55.735556, 37.765),
 'Шоссе Энтузиастов': (55.758633, 37.748477),
 'Авиамоторная': (55.750278, 37.721944),
 'Площадь Ильича': (55.747115, 37.680726),
 'Марксистская': (55.740746, 37.65604),
 'Третьяковская': (55.74073, 37.625624),
 'Ховрино': (55.879444, 37.486667),
 'Беломорская': (55.8651, 37.4764),
 'Речной вокзал': (55.854152, 37.476728),
 'Водный стадион': (55.838978, 37.487515),
 'Войковская': (55.818923, 37.497791),
 'Сокол': (55.805564, 37.515245),
 'Аэропорт': (55.800441, 37.530477),
 'Динамо': (55.789704, 37.558212),
 'Белорусская': (55.776389, 37.580278),
 'Маяковская': (55.769808, 37.596192),
 'Тверская': (55.765343, 37.603918),
 'Театральная': (55.758808, 37.61768),
 'Новокузнецкая': (55.742391, 37.62928),
 'Павелецкая': (55.731414, 37.636294),
 'Автозаводская': (55.70631, 37.66314),
 'Технопарк': (55.695, 37.664167),
 'Коломенская': (55.677423, 37.663719),
 'Каширская': (55.655, 37.648611),
 'Кантемировская': (55.636107, 37.656218),
 'Царицыно': (55.618309, 37.668846),
 'Орехово': (55.61269, 37.695214),
 'Домодедовская': (55.610131, 37.717111),
 'Красногвардейская': (55.614075, 37.742697),
 'Алма-Атинская': (55.63349, 37.765678),
 'Медведково': (55.888103, 37.661562),
 'Бабушкинская': (55.870641, 37.664341),
 'Свиблово': (55.855558, 37.653379),
 'Ботанический сад': (55.845556, 37.640278),
 'ВДНХ': (55.819626, 37.640751),
 'Алексеевская': (55.807794, 37.638699),
 'Рижская': (55.793889, 37.638611),
 'Проспект Мира': (55.779584, 37.633646),
 'Сухаревская': (55.772315, 37.63285),
 'Тургеневская': (55.765371, 37.636732),
 'Китай-город': (55.75436, 37.633877),
 'Октябрьская': (55.729264, 37.611049),
 'Шаболовская': (55.718828, 37.607892),
 'Ленинский проспект': (55.70678, 37.58499),
 'Академическая': (55.687147, 37.5723),
 'Профсоюзная': (55.677671, 37.562595),
 'Новые Черемушки': (55.670077, 37.554493),
 'Калужская': (55.656682, 37.540075),
 'Беляево': (55.642357, 37.526115),
 'Коньково': (55.631857, 37.519156),
 'Теплый Стан': (55.61873, 37.505912),
 'Ясенево': (55.606182, 37.5334),
 'Новоясеневская': (55.601947, 37.553017),
 'Бульвар Рокоссовского': (55.817222, 37.736944),
 'Черкизовская': (55.802787, 37.744863),
 'Преображенская площадь': (55.796322, 37.713582),
 'Сокольники': (55.791111, 37.678889),
 'Красносельская': (55.780014, 37.666097),
 'Комсомольская': (55.775672, 37.654772),
 'Красные ворота': (55.768307, 37.6478),
 'Чистые пруды': (55.76499, 37.638293),
 'Лубянка': (55.759889, 37.625336),
 'Охотный ряд': (55.757228, 37.615078),
 'Библиотека им.Ленина': (55.752123, 37.610388),
 'Кропоткинская': (55.745297, 37.604217),
 'Парк культуры': (55.735221, 37.593095),
 'Фрунзенская': (55.727462, 37.58022),
 'Спортивная': (55.722388, 37.562041),
 'Воробьевы горы': (55.709169, 37.557293),
 'Университет': (55.69329, 37.534511),
 'Проспект Вернадского': (55.677778, 37.505),
 'Юго-Западная': (55.663146, 37.482852),
 'Тропарево': (55.6459, 37.4725),
 'Румянцево': (55.633, 37.4419),
 'Саларьево': (55.6227, 37.424),
 'Филатов луг': (55.5997, 37.4075),
 'Прокшино': (55.5813, 37.4425),
 'Ольховая': (55.5692, 37.4589),
 'Коммунарка': (55.559765, 37.468716),
 'Щелковская': (55.809962, 37.798261),
 'Первомайская': (55.794376, 37.799364),
 'Измайловская': (55.787713, 37.779896),
 'Партизанская': (55.788401, 37.74882),
 'Семеновская': (55.783096, 37.719289),
 'Электрозаводская': (55.781111, 37.705278),
 'Бауманская': (55.772405, 37.67904),
 'Курская': (55.740833, 37.660556),
 'Площадь Революции': (55.756741, 37.62236),
 'Арбатская': (55.752122, 37.601553),
 'Смоленская': (55.749083, 37.582173),
 'Киевская': (55.74361, 37.56735),
 'Парк Победы': (55.736478, 37.514401),
 'Славянский бульвар': (55.729722, 37.470556),
 'Кунцевская': (55.730554, 37.445591),
 'Молодежная': (55.741375, 37.415627),
 'Крылатское': (55.756842, 37.408139),
 'Строгино': (55.803831, 37.402405),
 'Мякинино': (55.823342, 37.385214),
 'Волоколамская': (55.835154, 37.382453),
 'Митино': (55.846098, 37.36122),
 'Пятницкое шоссе': (55.853634, 37.353108),
 'Пионерская': (55.736027, 37.466728),
 'Филевский парк': (55.739665, 37.483902),
 'Багратионовская': (55.743544, 37.497042),
 'Фили': (55.744263, 37.514526),
 'Кутузовская': (55.741944, 37.533056),
 'Студенческая': (55.738761, 37.54842),
 'Александровский сад': (55.752255, 37.608775),
 'Выставочная': (55.750243, 37.542641),
 'Международная': (55.748324, 37.533282),
 'Алтуфьево': (55.899034, 37.586473),
 'Бибирево': (55.883868, 37.603011),
 'Отрадное': (55.864273, 37.605066),
 'Владыкино': (55.847222, 37.591944),
 'Петровско-Разумовская': (55.839722, 37.568333),
 'Тимирязевская': (55.81866, 37.574498),
 'Дмитровская': (55.808056, 37.581734),
 'Савёловская': (55.794444, 37.590278),
 'Менделеевская': (55.781999, 37.599141),
 'Цветной бульвар': (55.771653, 37.620466),
 'Чеховская': (55.765747, 37.608493),
 'Боровицкая': (55.750399, 37.60934),
 'Полянка': (55.736795, 37.618594),
 'Серпуховская': (55.726548, 37.624792),
 'Тульская': (55.70961, 37.622569),
 'Нагатинская': (55.682099, 37.620917),
 'Нагорная': (55.672962, 37.610397),
 'Нахимовский проспект': (55.662379, 37.605274),
 'Севастопольская': (55.651451, 37.59809),
 'Чертановская': (55.640538, 37.606065),
 'Южная': (55.622436, 37.609047),
 'Пражская': (55.610962, 37.602386),
 'Улица Академика Янгеля': (55.596753, 37.601498),
 'Аннино': (55.583477, 37.596999),
 'Бульвар Дмитрия Донского': (55.568201, 37.576856),
 'Планерная': (55.859676, 37.436808),
 'Сходненская': (55.84926, 37.44076),
 'Тушинская': (55.825479, 37.437024),
 'Спартак': (55.8182, 37.4352),
 'Щукинская': (55.8094, 37.463241),
 'Октябрьское поле': (55.793581, 37.493317),
 'Полежаевская': (55.777201, 37.517895),
 'Беговая': (55.770833, 55.770833),
 'Улица 1905 года': (55.763944, 37.562271),
 'Баррикадная': (55.760793, 37.581242),
 'Пушкинская': (55.765607, 37.604356),
 'Кузнецкий мост': (55.761498, 37.624423),
 'Таганская': (55.742396, 37.653334),
 'Пролетарская': (55.731546, 37.666917),
 'Волгоградский проспект': (55.725546, 37.685197),
 'Текстильщики': (55.708934, 37.731283),
 'Кузьминки': (55.705493, 37.763295),
 'Рязанский проспект': (55.716139, 37.792694),
 'Выхино': (55.88, 37.816667),
 'Лермонтовский проспект': (55.702036, 37.851044),
 'Жулебино': (55.684722, 37.855833),
 'Котельники': (55.6743, 37.8582),
 'Новослободская': (55.779606, 37.601252),
 'Добрынинская': (55.728994, 37.622533),
 'Краснопресненская': (55.760378, 37.577114),
 'Физтех': (55.921389, 37.546389),
 'Лианозово': (55.897316, 37.553261),
 'Яхромская': (55.8775, 37.545833),
 'Селигерская': (55.86483, 37.55005),
 'Верхние Лихоборы': (55.85566, 37.56282),
 'Окружная': (55.848889, 37.571111),
 'Фонвизинская': (55.822778, 37.588056),
 'Бутырская ': (55.813333, 37.602778),
 'Марьина Роща': (55.800833, 37.618889),
 'Достоевская': (55.781667, 37.613889),
 'Трубная': (55.76771, 37.621926),
 'Сретенский бульвар': (55.766106, 37.635688),
 'Чкаловская': (55.755951, 37.659293),
 'Римская': (55.747027, 37.679996),
 'Крестьянская застава': (55.732278, 37.665325),
 'Дубровка': (55.71268, 37.677775),
 'Кожуховская': (55.706156, 37.68544),
 'Печатники': (55.694722, 37.7275),
 'Волжская': (55.690446, 37.754314),
 'Люблино': (55.676596, 37.761639),
 'Братиславская': (55.658817, 37.748415),
 'Марьино': (55.649158, 37.743844),
 'Борисово': (55.6325, 37.743333),
 'Шипиловская': (55.621667, 37.743611),
 'Зябликово': (55.611944, 37.745278),
 'Варшавская': (55.653333, 37.619444),
 'Каховская': (55.653056, 37.598333),
 'Бунинская аллея': (55.537977, 37.515899),
 'Улица Горчакова': (55.542281, 37.532063),
 'Бульвар Адмирала Ушакова': (55.545207, 37.542329),
 'Улица Скобелевская': (55.548103, 37.552721),
 'Улица Старокачаловская': (55.569194, 37.576074),
 'Лесопарковая': (55.581656, 37.577816),
 'Битцевский Парк': (55.600066, 37.556058),
 'Деловой центр': (55.7491, 37.5395),
 'Пыхтино': (55.625, 37.298056),
 'Минская': (55.723333, 37.533056),
 'Ломоносовский проспект': (55.7055, 37.5225),
 'Раменки': (55.6961, 37.505),
 'Мичуринский проспект': (55.688333, 37.485),
 'Озёрная': (55.6698, 37.4495),
 'Говорово': (55.6588, 37.4174),
 'Солнцево': (55.649, 37.3911),
 'Боровское шоссе': (55.647, 37.3701),
 'Новопеределкино': (55.639167, 37.381111),
 'Рассказовка': (55.6324, 37.3328),
 'Ростокино': (55.839444, 37.667778),
 'Белокаменная': (55.83, 37.700556),
 'Локомотив': (55.803219, 37.745742),
 'Измайлово': (55.788611, 37.742778),
 'Соколиная Гора': (55.77, 37.745278),
 'Андроновка': (55.744444, 37.741111),
 'Нижегородская': (55.733333, 37.729444),
 'Новохохловская': (55.718523, 37.719236),
 'Угрешская': (55.718333, 37.697778),
 'ЗИЛ': (55.698333, 37.648333),
 'Верхние Котлы': (55.69, 37.618889),
 'Крымская': (55.690038, 37.605),
 'Площадь Гагарина': (55.706944, 37.585833),
 'Лужники': (55.720278, 37.563056),
 'Шелепиха': (55.75723, 37.52571),
 'Хорошево': (55.777222, 37.507222),
 'Зорге': (55.787778, 37.504444),
 'Панфиловская': (55.799167, 37.498889),
 'Стрешнево': (55.813611, 37.486944),
 'Балтийская': (55.825833, 37.496111),
 'Коптево': (55.839637, 37.520037),
 'Лихоборы': (55.85, 37.5525),
 'Улица Милашенкова': (55.821876, 37.591206),
 'Телецентр': (55.821795, 37.608975),
 'Улица Академика Королёва': (55.821821, 37.627167),
 'Выставочный центр': (55.824086, 37.638494),
 'Улица Сергея Эйзенштейна': (55.829305, 37.644997),
 'Новаторская': (55.670833, 37.52),
 'Воронцовская': (55.658333, 37.540833),
 'Зюзино': (55.655158, 37.575786),
 'Кленовый бульвар': (55.674444, 37.680833),
 'Нагатинский Затон': (55.684444, 37.703611),
 'Лефортово': (55.764444, 37.702778),
 'Петровский парк': (55.79233, 37.55952),
 'ЦСКА': (55.78643, 37.53502),
 'Хорошевская': (55.77643, 37.51981),
 'Народное Ополчение': (55.775278, 39.484444),
 'Мнёвники': (55.761153, 37.47139),
 'Терехово': (55.748108, 37.459738),
 'Давыдково': (55.715278, 37.451667),
 'Аминьевская': (55.699444, 37.468056),
 'Косино': (55.714167, 37.8475),
 'Улица Дмитриевского': (55.7093, 37.8792),
 'Лухмановская': (55.7078, 37.9004),
 'Некрасовка': (55.7029, 37.9264),
 'Юго-Восточная': (55.71, 37.82),
 'Окская': (55.72, 37.77),
 'Стахановская': (55.73, 37.76),
 'Лобня': (56.0048, 37.29057),
 'Шереметьевская': (55.983882, 37.498752),
 'Хлебниково': (55.970682, 37.504638),
 'Водники': (55.953419, 37.511143),
 'Долгопрудная': (55.938656, 37.520542),
 'Новодачная': (55.924459, 37.527877),
 'Марк': (55.904458, 37.538242),
 'Бескудниково': (55.882713, 37.567768),
 'Дегунино': (55.86586, 37.573235),
 'Тестовская': (55.750833, 37.530278),
 'Рабочий Посёлок': (55.726957, 37.415577),
 'Сетунь': (55.723713, 37.397259),
 'Немчиновка': (55.715668, 37.374611),
 'Сколково': (55.666801, 37.424618),
 'Баковка': (55.682816, 37.315205),
 'Одинцово': (55.67798, 37.27773),
 'Нахабино': (55.841522, 37.185204),
 'Аникеевка': (55.832099, 37.219829),
 'Опалиха': (55.82333, 37.246843),
 'Красногорская': (55.814571, 37.303337),
 'Павшино': (55.815231, 37.341461),
 'Пенягино': (55.822539, 37.361049),
 'Трикотажная': (55.833137, 37.398967),
 'Покровское-Стрешнево': (55.814247, 37.47678),
 'Красный Балтиец': (55.815514, 37.526367),
 'Гражданская': (55.805527, 37.55315),
 'Площадь трёх вокзалов': (55.776667, 37.651111),
 'Москва Товарная': (55.745358, 37.688839),
 'Калитники': (55.733981, 37.702203),
 'Депо': (55.674257, 37.728446),
 'Перерва': (55.660809, 37.716278),
 'Курьяново': (55.649722, 37.701667),
 'Москворечье': (55.641239, 37.689789),
 'Покровское': (55.814247, 37.47678),
 'Красный строитель': (55.589455, 37.615093),
 'Битца': (55.571186, 37.611443),
 'Бутово': (55.548279, 37.555668),
 'Щербинка': (55.509724, 37.562008),
 'Остафьево': (55.50337, 37.520055),
 'Силикатная': (55.470278, 37.555278),
 'Подольск': (55.431667, 37.565),
 'Крюково': (55.979722, 37.173611),
 'Малино': (55.969167, 37.211667),
 'Фирсановская': (55.960278, 37.251111),
 'Сходня': (55.949722, 37.298611),
 'Подрезково': (55.941667, 37.334722),
 'Новоподрезково': (55.936389, 37.351667),
 'Молжаниново': (55.924167, 37.380833),
 'Химки': (55.894444, 37.450833),
 'Левобережная': (55.886944, 37.468611),
 'Грачёвская': (55.869444, 37.509167),
 'Моссельмаш': (55.862222, 37.526389),
 'Останкино': (55.817222, 37.603611),
 'Митьково': (55.786389, 37.6675),
 'Сортировочная': (55.763611, 37.720833),
 'Плющево': (55.730556, 37.774167),
 'Вешняки': (55.721944, 37.799167),
 'Ухтомская': (55.698611, 37.864167),
 'Люберцы I': (55.681667, 37.896944),
 'Панки': (55.668889, 37.9225),
 'Томилино': (55.655, 37.954722),
 'Красково': (55.649722, 37.9825),
 'Малаховка': (55.645, 38.008333),
 'Удельная': (55.634444, 38.043889),
 'Быково': (55.626667, 38.070556),
 'Ильинская': (55.616389, 38.100278),
 'Отдых': (55.601111, 38.136944),
 'Кратово': (55.591667, 38.16),
 'Есенинская': (55.581944, 38.184167),
 'Фабричная': (55.572778, 1.873333),
 'Раменское': (55.565278, 55.565278),
 'Ипподром': (55.560278, 38.238889),
 'Железнодорожная': (55.7525, 38.008889),
 'Ольгино': (55.751667, 37.978611),
 'Кучино': (55.752222, 37.954722),
 'Салтыковская': (55.757778, 37.923056),
 'Никольское': (55.759722, 37.897778),
 'Реутово': (55.751389, 37.855833),
 'Кусково': (55.739722, 37.795278),
 'Чухлинка': (55.733889, 55.733889),
 'Серп и Молот': (55.748056, 37.681944),
 'Ермакова Роща': (55.765556, 37.535278),
 'Поклонная': (55.728333, 37.511667),
 'Матвеевское': (55.704722, 37.482222),
 'Очаково I': (55.683611, 37.451389),
 'Мещерская': (55.666667, 37.424444),
 'Солнечная': (55.656944, 37.383611),
 'Переделкино': (55.656111, 37.353889),
 'Мичуринец': (55.646111, 37.315),
 'Внуково': (55.648889, 37.269722),
 'Лесной Городок': (55.630278, 37.219167),
 'Толстопальцево': (55.607778, 37.186389),
 'Кокошкино': (55.599722, 37.171389),
 'Санино': (55.583889, 37.138333),
 'Крёкшино': (55.577778, 37.109722),
 'Победа': (55.566111, 37.093056),
 'Апрелевка': (55.550278, 37.0675)
        };

    // Function to show/hide the suggestion box
    function toggleSuggestions(show) {
        metroSuggestions.style.display = show ? 'block' : 'none';
    }

    // Function to update the suggestion box with filtered suggestions

    // Function to update the suggestion box with filtered suggestions
    // Function to update the suggestion box with filtered suggestions

// Function to update the suggestion box with filtered suggestions
function updateSuggestions(suggestions) {
    metroSuggestions.innerHTML = '';
    suggestions.forEach(function(suggestion, index) {
        const suggestionElement = document.createElement('div');
        suggestionElement.classList.add('suggestion');
        suggestionElement.textContent = suggestion;
        suggestionElement.addEventListener('click', function() {
            // Update the input field with the clicked suggestion's value
            const suggestionValue = MetroStationsObject[suggestion]; // Assuming MetroStationsObject contains station names as keys and coordinates as values
            metroStationInput.value = suggestionValue;
            // Hide the suggestion box after selection
            toggleSuggestions(false);
            event.stopPropagation();
        });
        metroSuggestions.appendChild(suggestionElement);
    });
    highlightedIndex = 0; // Set the first suggestion as highlighted
    highlightSuggestion(); // Highlight the first suggestion
}


    // Event listener for input field to handle suggestions
    metroStationInput.addEventListener('focus', function() {
        const inputWidth = metroStationInput.offsetWidth;
        metroSuggestions.style.maxWidth = inputWidth + 'px';
        const inputValue = metroStationInput.value;
        const suggestions = filterSuggestions(inputValue);
        if (suggestions.length > 0) {
            toggleSuggestions(true);
            updateSuggestions(suggestions); // Show all suggestions
        } else {
            toggleSuggestions(false);
        }
    });

    // Event listener for Enter key to auto-complete suggestion
    metroStationInput.addEventListener('keydown', function(event) {
        if (event.key === 'Enter' && metroSuggestions.style.display === 'block') {
            metroStationInput.value = metroSuggestions.childNodes[highlightedIndex].textContent;
            toggleSuggestions(false);
        } else if (event.key === 'Tab' && metroSuggestions.style.display === 'block') {
            event.preventDefault();
            highlightedIndex = (highlightedIndex + 1) % metroSuggestions.childNodes.length;
            highlightSuggestion();
            ensureHighlightedInView(); // Scroll to ensure highlighted suggestion is in view
        }
    });

    // Event listener to hide suggestions when clicking outside the input field
    document.addEventListener('click', function(event) {
        if (!metroSuggestions.contains(event.target) && event.target !== metroStationInput) {
            toggleSuggestions(false);
        }
    });

    // Function to filter suggestions based on input value
    function filterSuggestions(inputValue) {
        const filteredSuggestions = Object.keys(MetroStationsObject).filter(function(station) {
            return station.toLowerCase().startsWith(inputValue.toLowerCase());
        });
        return filteredSuggestions;
    }

    // Function to highlight the suggestion at the given index
    function highlightSuggestion() {
        const suggestions = metroSuggestions.querySelectorAll('.suggestion');
        suggestions.forEach(function(suggestion, index) {
            if (index === highlightedIndex) {
                suggestion.style.backgroundColor = '#006aff'; // CIAN color
                suggestion.style.color = 'white'; // White text color
            } else {
                suggestion.style.backgroundColor = 'white';
                suggestion.style.color = 'black';
            }
        });
    }

    // Function to ensure highlighted suggestion is in view
    function ensureHighlightedInView() {
        const suggestions = metroSuggestions.querySelectorAll('.suggestion');
        const highlightedSuggestion = suggestions[highlightedIndex];
        const suggestionBoxRect = metroSuggestions.getBoundingClientRect();
        const highlightedSuggestionRect = highlightedSuggestion.getBoundingClientRect();
        if (highlightedSuggestionRect.top < suggestionBoxRect.top) {
            metroSuggestions.scrollTop -= suggestionBoxRect.top - highlightedSuggestionRect.top;
        } else if (highlightedSuggestionRect.bottom > suggestionBoxRect.bottom) {
            metroSuggestions.scrollTop += highlightedSuggestionRect.bottom - suggestionBoxRect.bottom;
        }
    }

    // Set suggestion box width to match input field width
    metroStationInput.addEventListener('input', function() {
        metroSuggestions.style.width = metroStationInput.offsetWidth + 'px';
    const inputValue = metroStationInput.value;
    const suggestions = filterSuggestions(inputValue);
    if (suggestions.length > 0) {
        toggleSuggestions(true);
        updateSuggestions(suggestions);
    } else {
        toggleSuggestions(false);
    }
    });
    metroStationInput.addEventListener('blur', function() {
        toggleSuggestions(false);
    });
});

